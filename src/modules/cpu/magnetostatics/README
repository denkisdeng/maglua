Parts of this code was created by Martin Leblanc
